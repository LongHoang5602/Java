<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">|

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Book List</title>
  <th:block th:replace="layout :: link-css"></th:block>
</head>

<body>
  <th:block th:replace="layout :: header"></th:block>
  <div class="container">
    <h1 th:text=${title}></h1>
    <table class="table">
      <tr>
        <th>STT</th>
        <th>Title</th>
        <th>Author</th>
        <th>Price</th>
        <th>Image</th>
        <th>Category</th>
        <th>Action</th>
      </tr>
      <tr th:each="book,i : ${listBook}">
        <!-- <td th:text="${book.id}"></td> -->
        <td th:text="${#numbers.sequence(1, 1000)[i.index]}"></td>
        <td th:text="${book.title}"></td>
        <td th:text="${book.author}"></td>
        <td th:text="${book.price}"></td>
        <td th:text="${book.image}"></td>
        <td th:text="${book.category.name}"></td>
        <td sec:authorize="hasAnyAuthority('ADMIN')">
          <a th:href="@{/books/edit/{id}(id=${book.id})}">Edit</a>
          <a th:href="@{/books/delete/{id}(id=${book.id})}" onclick="deleteBook(this); return false;"
            class="text-danger">Delete</a>

        </td>
      </tr>
    </table>
  </div>
  <script th:src="@{/js/jquery-3.7.0.slim.min.js}"></script>
  <script th:inline="javascript">
    function deleteBook(link) {
      if (confirm('Are you sure ?')) {
        $.ajax({
          url: $(link).attr('href'),
          type: 'DELETE',
          success: result => {
            if (!result.success) {
              alert(result.message);
            } else {
              $(link).parent().parent().remove();
            }
          }
        })
      }
    }
  </script>
  <th:block th:replace="layout :: footer"></th:block>
</body>

</html>